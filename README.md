# stereo-visuals-tasks
MIT project tasks
week 2
# 立体视觉深度估计工具使用说明

## 项目简介
这是一个基于OpenCV和PySide6的立体视觉深度估计工具，支持BM和SGBM两种立体匹配算法，可用于双目图像深度图生成与分析。

## 功能特性

### 1. 核心功能
- **BM算法**：基于块匹配的快速立体匹配算法
- **SGBM算法**：半全局块匹配算法，精度更高
- **实时对比**：同时对比两种算法效果
- **多种深度计算方式**：
  - 相对深度（归一化）
  - 绝对深度（手动参数）
  - 绝对深度（标定文件）

### 2. 参数调节
- **视差范围**：16-256（16的倍数）
- **块大小**：5-255（BM），3-11（SGBM）
- **纹理阈值**：0-100
- **唯一性比率**：0-100
- **斑点滤波**：窗口大小和范围可调
- **预处理参数**：滤波器大小和截断值

### 3. 数据输入输出
- **输入**：左右图像对（支持自动匹配）
- **输出**：彩色深度图（JET色彩映射）
- **保存功能**：深度图和参数文本文件
- **标定文件**：支持txt/yaml/yml格式

## 系统要求

### 硬件要求
- CPU：Intel i5或同等性能以上
- 内存：8GB以上
- 显卡：支持OpenCV硬件加速
- 存储：100MB可用空间

### 软件要求
- **操作系统**：Windows 10/11，Linux，macOS
- **Python版本**：3.8+
- **依赖库**：
  - PySide6 >= 6.5.0
  - OpenCV >= 4.5.0
  - NumPy >= 1.21.0

## 安装步骤

### 方法一：直接运行源码
```bash
# 1. 克隆或下载项目
git clone <repository-url>
cd stereo_vision_tool

# 2. 安装依赖
pip install -r requirements.txt

# 3. 运行程序
python "Depth map analysis tool.py"
```

### 方法二：使用PyInstaller打包后的.exe（Windows）

## 快速入门指南

### 1. 启动程序
双击`Depth map analysis tool.exe`或运行Python脚本

### 2. 加载图像
1. 点击"浏览..."选择左图像
2. 程序会自动尝试匹配右图像
3. 如果自动匹配失败，手动选择右图像

### 3. 设置参数
- **基本参数**：视差范围、块大小
- **优化参数**：纹理阈值、唯一性比率
- **深度计算**：选择计算方式
  - 相对深度：快速预览
  - 绝对深度：需要焦距和基线参数

### 4. 生成深度图
1. 选择BM或SGBM算法标签页
2. 点击"生成BM深度图"或"生成SGBM深度图"
3. 查看右侧显示区域的结果

### 5. 对比分析
1. 切换到"两者对比"标签页
2. 设置统一参数
3. 点击"对比生成"同时运行两种算法
4. 查看对比统计信息

### 6. 保存结果
1. 点击"保存深度图"保存当前算法结果
2. 点击"保存所有结果"保存对比分析结果
3. 文件包含：深度图图片和参数文本文件

## 参数详细说明

### BM算法参数
| 参数名称 | 默认值 | 范围 | 说明 |
|---------|--------|------|------|
| 视差范围 | 96 | 16-256 | 搜索范围，16的倍数 |
| 块大小 | 11 | 5-255 | 匹配窗口大小，奇数 |
| 纹理阈值 | 10 | 0-100 | 纹理不足区域阈值 |
| 唯一性比率 | 15 | 0-100 | 匹配唯一性要求 |
| 斑点窗口 | 100 | 0-1000 | 后处理滤波窗口 |
| 斑点范围 | 32 | 0-100 | 视差变化阈值 |

### SGBM算法参数
| 参数名称 | 默认值 | 范围 | 说明 |
|---------|--------|------|------|
| 最小视差 | 0 | -100-100 | 搜索起始视差 |
| P1参数 | 1176 | 0-10000 | 平滑惩罚参数1 |
| P2参数 | 4704 | 0-100000 | 平滑惩罚参数2 |
| 算法模式 | SGBM | SGBM/3WAY/HH | 算法实现方式 |

### 标定参数
| 参数名称 | 默认值 | 单位 | 说明 |
|---------|--------|------|------|
| 焦距 | 1000 | 像素 | 相机焦距 |
| 基线 | 0.54 | 米 | 相机间距离 |

## 使用技巧

### 1. 参数调节建议
- **室内场景**：视差范围64-128，块大小9-15
- **室外场景**：视差范围96-192，块大小11-21
- **高纹理图像**：降低纹理阈值（5-10）
- **低纹理图像**：提高纹理阈值（20-50）

### 2. 性能优化
- **快速测试**：使用小尺寸图像（640x480）
- **精度优先**：使用SGBM算法，HH模式
- **速度优先**：使用BM算法，减小视差范围

### 3. 常见问题解决
- **图像不匹配**：确保左右图像尺寸一致
- **深度图空白**：检查纹理阈值设置
- **计算速度慢**：减小视差范围和块大小
- **内存不足**：使用小尺寸图像或64位Python

## 文件结构
```
stereo_vision_tool/
├── Depth map analysis tool.py    # 主程序
├── Depth-map-analysis tool.ui    # 用户界面设计
├── requirements.txt              # 依赖列表
├── data/                         # 示例数据
│   ├── left/                    # 左图像
│   └── right/                   # 右图像
├── output/                      # 输出目录
└── README.md                    # 本文档
```

## 更新日志

### v1.0.0 (2024-01-15)
- 初始版本发布
- 支持BM和SGBM算法
- 图形化参数调节界面
- 深度图可视化显示
- 结果保存功能

## 许可证
本项目采用MIT许可证。详见LICENSE文件。

